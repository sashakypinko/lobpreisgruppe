import{u as V,r as n,a as F,b as G,c as O,d as _,j as e,C as j,e as d,T as S,f as q,g as z,U as m,h as U,A as v,i as P,S as B}from"./index.bb8b3d71.js";import{S as l,C as T}from"./isTypedArray.b72bae26.js";import{u as J}from"./useError.bae9a88e.js";import{G as K,R as c}from"./index.98855357.js";const M={paper:{marginTop:"var(--theme-spacing-8)",display:"flex",flexDirection:"column",alignItems:"center"},form:{width:"100%",marginTop:"var(--theme-spacing-1)"},signUp:{textAlign:"center",marginTop:20},forgotPassword:{textAlign:"center",marginBottom:"2em"}},W={email:{type:"isEmail",text:"email.notValid"},password:[{type:"isEmpty",text:"errorDescription.password"}]},$=()=>{const p=V(M),[o,L]=n.exports.useState(""),[H,k]=n.exports.useState(!1),{t:a}=F(),A=G(),D=O(),{loading:R,Loading:b,setLoading:u}=_(),[r,I]=n.exports.useState({email:"",password:""});n.exports.useEffect(()=>{const{state:t}=D,{redirectFrom:s}=t||{};s&&L(s)},[]);const{setCustomError:g,isError:f,getActivateError:N}=J({values:r,validations:W}),h=async()=>{if(g(null),!N()){u(!0);const s=await U.postRequest(v.login,{email:r.email,password:r.password});if(!s.ok)(s==null?void 0:s.errorCode)===P.USER_NOT_VERIFIED&&k(!0),g({email:s.errorMessage}),u(!1);else{let C=null;o&&!o.includes(m.LOGOUT)&&!o.includes(m.SIGN_UP)&&(C=o);const y=await U.postRequest(v.fetchSessionData,{userId:s.data._id});let i={};if(y.ok){i=JSON.parse(y.data.sessionData||"{}");for(const E of Object.keys(i))await B.save(E,i[E])}A({redirectedFrom:C,...s.data,userSessionData:i})}}},w=t=>{t.key==="Enter"&&h().then()},x=({name:t,value:s})=>{I({...r,[t]:s})};return R?e(b,{}):e(j,{maxWidth:"xs",children:d("div",{className:p.paper,children:[e(S,{component:"h1",variant:"h2",children:a("login.headline")}),e(l,{size:2}),e("form",{className:p.form,noValidate:!0,children:d(K,{children:[e(c,{children:e(T,{name:"email",label:"email.address",id:"email","aria-label":a("email"),value:r.email,onChange:x,onKeyDown:w,type:"email",autoFocus:!0,required:!0,error:f("email")})}),e(l,{size:2}),e(c,{children:e(T,{name:"password",label:"password",id:"password","aria-label":a("password"),value:r.password,onChange:x,onKeyDown:w,type:"password",required:!0,error:f("password")})}),e(l,{size:2}),e(c,{children:e(q,{onClick:h,children:a("login")})}),e(l,{}),e(c,{align:"center",children:d(S,{children:[a("signUp.noAccount")," ",e(z,{to:m.SIGN_UP,children:a("signUp")})]})})]})})]})})};export{$ as default};
